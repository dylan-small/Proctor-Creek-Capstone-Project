{% load static %}
<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <link rel="stylesheet" href="{% static 'proctor_creek/css/index.css' %}">
    </head>
    <body>

        <!-- Add your site or application content here -->
        <h1>Team 1108</h1>
        <h2>Members: Joanna Tolentino, Sam Milner, Dylan Small, Grayson Raulston, Ryan Bauer</h2>


        <form action="{% url 'index' %}" method="POST">
            {% csrf_token %}
            <br>
            <label for="first_name">First Name:</label>
            <input type = "text" id="first_name" name="first_name", required="true">
            
            <label for="last_name">Last Name:</label>
            <input type = "text" id="last_name" name="last_name", required="true"><br>
            
            <label for="email">Email *:</label>
            <input type = "text" id="email" name="email", required="true"><br><!--use input type="email"to validate?-->
            
            <label for="phone">Phone *:</label>
            <input type = "text" id="phone" name="phone"><br>

            <label for="problem_select">Which describes the problem?</label><br>

            <input type="radio" id="tire_dumping_option" name="problem_type" value="Tire Dumping">
            <label for="tire_dumping_option">Tire Dumping</label><br>

            <input type="radio" id="standing_water_option" name="problem_type" value="Standing Water">
            <label for="standing_water_option">Standing Water</label><br>

            <input type="radio" id="miscellaneous" name="problem_type" value="Miscellaneous">
            <label for="miscellaneous">Miscellaneous</label><br>

            <label for="summary">Summary *:</label><br>
            <input type = "summary" id="summary" name="summary", required="true"><br>
            
            <img id="preview" alt="your image" width="300" height="300" />
            <input type="file" onchange="displayPicPreview(this)" accept="image/*" id="image" name="image"><br>
            <button type="button" onclick="storeImage()">Upload Image</button>
            <!--on change of this input field, place image in preview-->
            
            <button type="submit">Submit</button><br>
        </form>

        <!--
            Directions to add Firebase SDK:
            The core Firebase JS SDK is always required and must be listed first.
            Copy and paste these scripts into the bottom of your <body> tag,
            but before you use any Firebase services:
        -->

        <!-- TODO: Add SDKs for Firebase products that you want to use
             https://firebase.google.com/docs/web/setup#available-libraries
             /firebase-app must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js"></script>

        <script>
            // Your web app's Firebase configuration
            // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            var firebaseConfig = {
                apiKey: "AIzaSyBnh3EsTetGpOzDeGUXuQsT7Q-oF8fu1mU",
                authDomain: "proctor-creek-capstone-project.firebaseapp.com",
                projectId: "proctor-creek-capstone-project",
                storageBucket: "proctor-creek-capstone-project.appspot.com",
                messagingSenderId: "1099094981367",
                appId: "1:1099094981367:web:74525f31783efc681971f2",
                measurementId: "G-04YP1GBKLL"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            firebase.analytics();

            /**
             * This function processes the input image file and outputs to the img tag
             */
            function displayPicPreview(input) {
                document.getElementById('preview').src = window.URL.createObjectURL(input.files[0]);
            }

            /**
             * This function stores the image into Firebase storage
             */
            function storeImage() {
                var storage = firebase.storage();
                var imgFile = document.getElementById("image").files[0];
                var storageRef = storage.ref();
                var imgRef = storageRef.child('Report Images');
                var thisRef = imgRef.child(imgFile.name).put(imgFile);
                thisRef.on('state_changed',
                    (snapshot) => {
                        console.log("Continue.");
                    },

                    (error) => {
                        console.log("ERROR: " + error);
                    },

                    () => {
                        // after image uploads successfully, get the download URL
                        thisRef.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            console.log('File available at', downloadURL);
                            alert("Image upload was sucessful.")
                        });
                    }
                );
            }
        </script>
    </body>
</html>
